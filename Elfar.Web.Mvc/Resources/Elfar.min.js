Date.prototype.addDays=function(n){return(new Date).setDate(this.getDate()+n)};var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},Elfar;(function(n){"use strict";function a(){}var e,o,i,r,s,u,h,c;n.app;n.registerPlugin=a;e=function(){function t(){var n=this;this.select=function(t){var i=typeof t=="string"?n.tabs().first(function(n){return n.name===t}):t;i&&(ko.utils.arrayForEach(n.tabs(),function(n){return n.selected(!1)}),i.selected(!0))};this.add=function(t){var i=n.tabs;i.indexOf(t)===-1&&i.push(t);n.select(t)};this.remove=function(t){var i=n.tabs,r=i.indexOf(t);i.remove(t);t.selected()&&i()[--r].selected(!0)};this[0]=ko.observableArray([]);this.add(this[1]=new s)}return t.init=function(){ko.applyBindings(n.app=new t)},Object.defineProperty(t.prototype,"dashboard",{get:function(){return this[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"path",{get:function(){return location.pathname},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tabs",{get:function(){return this[0]},enumerable:!0,configurable:!0}),t}();n.App=e;o=function(){function n(n){$.extend(this,n);this.dateTime=new Date(n.Date+" "+n.Time)}return n}();n._Summary=o;i=function(){function n(n,t,i){this.name=n;this.title=t;this[0]=(i||n)+"-template"}return Object.defineProperty(n.prototype,"template",{get:function(){return this[0]},enumerable:!0,configurable:!0}),n}();n._Object=i;r=function(n){function t(t,i,r){r===void 0&&(r=!1);n.call(this,t,i);this[1]=ko.observable(r)}return __extends(t,n),Object.defineProperty(t.prototype,"closeable",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selected",{get:function(){return this[1]},enumerable:!0,configurable:!0}),t}(i);n.Tab=r;s=function(n){function t(){var t=this;n.call(this,"dashboard","Dashboard",!0);this.add=function(n){var i=t.sections;i.indexOf(n)===-1&&i.push(n)};this[2]=ko.observableArray();$.get(e.path+"/Summaries",function(n){n=n.reverse().select(function(n){return new o(n)});t.add(t[3]=new h(n));t.add(new u(null,"Latest","latest"));t.add(new u(null,"Most Common","common"))})}return __extends(t,n),Object.defineProperty(t.prototype,"closeable",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sections",{get:function(){return this[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"summary",{get:function(){return this[3]},enumerable:!0,configurable:!0}),t}(r);n.Dashboard=s;u=function(n){function t(t,i,r){n.call(this,t,i,r)}return __extends(t,n),t}(i);n.Section=u;h=function(n){function i(i){var o=this,u,e,r;n.call(this,"summary","Summary");this.add=function(n,t,i){i===void 0&&(i=1);o.tiles.push(new c(n,t,i))};this[1]=ko.observableArray();u=function(n,t){var i=this;this.area=n;this.controller=t;this.toString=function(){return"~/"+(i.area?i.area+"/":"")+i.controller}};e=i.groupBy(function(n){return new u(n.Area,n.Controller)}).select(function(n,i){return new p(n,t.colours[i])});this.add(new v("Controllers",e),"donut",0);this.add(new t(1),"chart",0);this.add(new t(2),"chart",2);this.add(new t(3),"chart");this.add(new t(4),"chart");r=(new Date).setHours(0,0,0,0);this.add(new f(90,i.where(function(n){return r<=n.dateTime.addDays(90)})),"term-tile");this.add(new f(30,i.where(function(n){return r<=n.dateTime.addDays(30)})),"term-tile");this.add(new f(7,i.where(function(n){return r<=n.dateTime.addDays(7)})),"term-tile");this.add(new f(1,i.where(function(n){return r<=n.dateTime.valueOf()})),"term-tile")}return __extends(i,n),Object.defineProperty(i.prototype,"tiles",{get:function(){return this[1]},enumerable:!0,configurable:!0}),i}(u);n.Summary=h;c=function(n){function t(t,i,r){r===void 0&&(r=1);n.call(this,null,null,i);this.content=t;this._size=r}return __extends(t,n),Object.defineProperty(t.prototype,"size",{get:function(){switch(this._size){case 0:return"large";case 2:return"wide";default:return"small"}},enumerable:!0,configurable:!0}),t}(i);n.Tile=c;var f=function(n){function t(t,i){n.call(this,"term-tab",t===1?"Today":"Last "+t+" days");this.data=ko.observableArray();this.data(i)}return __extends(t,n),Object.defineProperty(t.prototype,"count",{get:function(){return this.data().length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"css",{get:function(){return this.count?"lightblue-bg clickable":"grey-bg"},enumerable:!0,configurable:!0}),t}(r),t=function(n){function t(t){n.call(this,t,t);this.id=t}return __extends(t,n),t.prototype.toString=function(){return this.id},Object.defineProperty(t,"colours",{get:function(){return["#68217A","#007ACC","#217167","#A83A95","#1BA1E2","#571C75","#009CCC","#9ACD32","#F2700F"].concat(Highcharts.getOptions().colors)},enumerable:!0,configurable:!0}),t}(r),v=function(n){function t(t,i){var u=this,r;n.call(this,t);this.series=i;r={chart:{type:"pie",backgroundColor:"#F1F1F1",animation:!1},credits:{enabled:!1},title:{text:""+i.sum(function(n){return n.value}),y:27,verticalAlign:"middle",style:{fontSize:"33px"}},plotOptions:{pie:{shadow:!1,center:["50%","56%"]},series:{animation:!1}},series:[{name:this.id,data:i.select(function(n){return n.data}),size:"64%",innerSize:"53%",dataLabels:{color:"#FFF",format:"{y}",distance:-24,style:{fontWeight:"normal",textShadow:"none"}}}]};setTimeout(function(){return $("#"+u.id).highcharts(r)},1)}return __extends(t,n),t}(t),y=function(){function n(n,t,i){this.key=n;this.value=t;this.colour=i}return Object.defineProperty(n.prototype,"data",{get:function(){return{name:this.key.toString(),y:this.value,color:this.colour}},enumerable:!0,configurable:!0}),n}(),p=function(n){function t(t,i){n.call(this,t.key,t.length,i)}return __extends(t,n),t}(y),l;(function(n){n[n.Large=0]="Large";n[n.Small=1]="Small";n[n.Wide=2]="Wide"})(l||(l={}))})(Elfar||(Elfar={}));$(function(){return Elfar.App.init()});