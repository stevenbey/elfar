Date.prototype.addDays=function(n){return new Date(this.valueOf()).setDate(this.getDate()+n)};var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},Elfar;(function(n){"use strict";var l,a=function(){function n(){var t=this;this._dashboard=new s;this._errorLog=ko.observable();this._tabs=ko.observableArray([]);this.select=function(n){n&&(t._currentTab&&t._currentTab.blur(),(t._currentTab=n).focus())};this.add=function(n){if(n instanceof r){var i=t.tabs;i().contains(n)||i.push(n);t.select(n);return}t.dashboard.add(n)};this.remove=function(n){if(n&&n!==t.dashboard){var i=t.tabs,r=i.indexOf(n);n instanceof f&&(n.filter(""),n.clear());i.remove(n);n.selected()&&t.select(i()[--r])}};this.show=function(i){if(i.Url){t.errorLog(i);return}$.get(n.path+"Detail/"+i.ID,function(n){t.errorLog($.extend(i,n))})};this.add(this.dashboard)}return n.init=function(){ko.bindingHandlers.content={init:function(n,t){var i=n.contentWindow.document;i.close();i.write(ko.unwrap(t()))}};ko.applyBindings(l=new n);var t;$("#content").on("focus",".filter input",function(){var n=$(this);n.removeAttr("placeholder");n.parent().addClass("active")}).on("blur",".filter input",function(){var i=ko.dataFor(this),n;i.filter()||(n=$(this),t=setTimeout(function(){n.parent().removeClass("active");n.attr("placeholder","Filter")},150))}).on("click",".filter span",function(){var n=ko.dataFor(this);n.filter()?(n.filter(""),$(".filter input").blur()):($(this).parent().hasClass("active")&&clearTimeout(t),$(".filter input").focus())}).on("click",".list .body > div",function(){var n=ko.contextFor(this).$parent;n.clear();n.row=$(this).addClass("current selected")})},Object.defineProperty(n.prototype,"dashboard",{get:function(){return this._dashboard},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"errorLog",{get:function(){return this._errorLog},enumerable:!0,configurable:!0}),Object.defineProperty(n,"path",{get:function(){return n._path},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"tabs",{get:function(){return this._tabs},enumerable:!0,configurable:!0}),n._path=location.pathname+"/",n}(),o,i,r,s,t,h,u;n.App=a;o=function(){function n(n){$.extend(this,n);this.Area&&(this.Area="/"+this.Area);this.DateTime=new Date(n.Date+"T"+n.Time)}return n.prototype.show=function(n){return!!Object.keys(n).length},n}();n.ErrorLog=o;i=function(){function n(n,t,i){this.name=n;this.title=t;this._template=(i||n)+"-template";t||(this.title=n)}return Object.defineProperty(n.prototype,"template",{get:function(){return this._template},enumerable:!0,configurable:!0}),n}();n._Object=i;r=function(n){function t(t,i,r,u){u===void 0&&(u=!1);n.call(this,t,i,r);this._selected=ko.observable(u)}return __extends(t,n),t.prototype.blur=function(){this.selected(!1)},t.prototype.focus=function(){this.selected(!0)},Object.defineProperty(t.prototype,"closeable",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selected",{get:function(){return this._selected},enumerable:!0,configurable:!0}),t}(i);n.Tab=r;s=function(n){function i(){var t=this;n.call(this,"dashboard","Dashboard",null,!0);this._sections=ko.observableArray();$.get(a.path+"Summaries",function(n){n=n.reverse().select(function(n){return new o(n)});t.add(t._summary=new h(n));t.add(new d(n));t.add(new g("Type",n,function(n){return n.Type}))})}return __extends(i,n),i.prototype.add=function(n){if(n instanceof t){var i=this.sections;i().contains(n)||i.push(n);return}this.summary.add(n)},Object.defineProperty(i.prototype,"closeable",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"sections",{get:function(){return this._sections},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"summary",{get:function(){return this._summary},enumerable:!0,configurable:!0}),i}(r);n.Dashboard=s;t=function(n){function t(t,i,r){n.call(this,t,i,r)}return __extends(t,n),t}(i);n.Section=t;h=function(n){function t(t){n.call(this,"summary","Summary");this._tiles=ko.observableArray();this.add(new w("Timeline",t.groupBy(function(n){return n.Date}),90),"chart",3);var i=(new Date).setHours(0,0,0,0);this.add(new e(90,t=t.where(function(n){return i<=n.DateTime.addDays(90)})),"term");this.add(new e(30,t=t.where(function(n){return i<=n.DateTime.addDays(30)})),"term");this.add(new e(7,t=t.where(function(n){return i<=n.DateTime.addDays(7)})),"term");this.add(new e(1,t.where(function(n){return i<=n.DateTime.valueOf()})),"term");this.add(new v("Actions",t.groupBy(function(n){return new y(n.Area,n.Controller,n.Action)})),"donut",0);this.add(new v("Controllers",t.groupBy(function(n){return new y(n.Area,n.Controller)})),"donut",0)}return __extends(t,n),t.prototype.add=function(n,t,i){i===void 0&&(i=1);n instanceof u||(n=new u(n,t,i));this.tiles.push(n)},Object.defineProperty(t.prototype,"tiles",{get:function(){return this._tiles},enumerable:!0,configurable:!0}),t}(t);n.Summary=h;u=function(n){function t(t,i,r){r===void 0&&(r=1);n.call(this,null,null,i);this.content=t;this._size=r}return __extends(t,n),Object.defineProperty(t.prototype,"size",{get:function(){return c[this._size].toLowerCase()},enumerable:!0,configurable:!0}),t}(i);n.Tile=u;var p=function(){function n(){}return Object.defineProperty(n,"colours",{get:function(){return n._colours},enumerable:!0,configurable:!0}),n._colours=["#68217A","#007ACC","#217167","#A83A95","#1BA1E2","#571C75","#009CCC","#9ACD32","#F2700F","#748189"].concat(Highcharts.getOptions().colors),n}(),v=function(){function n(n,t){this.id=n;var i=(this.series=[new b(n,t)])[0],r=function(n){return l.add(i.points.first(function(t){return t.title===n.point.name}))},u={chart:{type:"pie",backgroundColor:"#F1F1F1",animation:!1},credits:{enabled:!1},tooltip:{enabled:!1},title:{text:i.count.toString(),y:27,verticalAlign:"middle",style:{fontSize:"33px"}},plotOptions:{pie:{shadow:!1,center:["50%","56%"],cursor:"pointer",events:{click:r}},series:{animation:!1,states:{hover:{enabled:!1}}}},series:[{name:n,data:i.data,size:"64%",innerSize:"53%",dataLabels:{color:"#FFF",format:"{y}",distance:-24,style:{fontWeight:"normal",textShadow:"none"}}}]};setTimeout(function(){return $("#"+n).highcharts(u)},1)}return n}(),w=function(){function n(n,t,i){this.id=n;this.groups=t;this.days=i;this.start=(new Date).addDays(-i+1);var r={chart:{backgroundColor:"#F1F1F1"},credits:{enabled:!1},xAxis:{type:"datetime",labels:{enabled:!1},lineWidth:0,tickLength:0},yAxis:{title:"",labels:{enabled:!1},min:0,max:t.max(function(n){return n.length}),gridLineWidth:0},legend:{enabled:!1},plotOptions:{area:{color:"#BBB",marker:{enabled:!1,states:{hover:{enabled:!1},select:{enabled:!1}}}},series:{animation:!1,states:{hover:{enabled:!1}}}},title:{text:""},tooltip:{enabled:!1},series:[{type:"area",name:"Error Logs",pointInterval:864e5,pointStart:this.start,data:this.data}]};setTimeout(function(){return $("#"+n).highcharts(r)},1)}return Object.defineProperty(n.prototype,"data",{get:function(){for(var t,i=[],n=new Date(this.start),r=-this.days;r<0;r++)t=this.groups.first(function(t){return t.key===n.toISOString().split("T")[0]}),i.push(t?t.length:0),n.setDate(n.getDate()+1);return i},enumerable:!0,configurable:!0}),n}(),b=function(){function n(n,t){this.points=t.select(function(t,i){return new k(n,t,p.colours[i])})}return Object.defineProperty(n.prototype,"data",{get:function(){return this.points.select(function(n){return{name:n.title,y:n.value,color:n.colour}})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"count",{get:function(){return this.points.length},enumerable:!0,configurable:!0}),n}(),f=function(n){function t(i,r,u){var f=this;n.call(this,r,u,"list");this.errorLogs=i;this._filter=ko.observable("");this.rows=ko.computed(function(){var n=f.filter().toLowerCase(),i;return!n||n.length<3?f.errorLogs:(i=t.props,f.errorLogs.where(function(t){for(var r=0;r<i.length;r++)if(t[i[r]].toLowerCase().indexOf(n)!==-1)return!0;return!1}))})}return __extends(t,n),t.prototype.blur=function(){n.prototype.blur.call(this);this.row&&this.row.removeClass("current")},t.prototype.clear=function(){this.row&&this.row.removeClass("selected")},Object.defineProperty(t.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this.title.replace(/~?\/|\s/g,"")||"root"},enumerable:!0,configurable:!0}),t.props=["Type","Action","Controller","Area","HttpMethod","Date"],t}(r),k=function(n){function t(t,i,r){n.call(this,i,i.key[t.slice(0,-1)]||"[root]",i.key.toString());this.colour=r}return __extends(t,n),Object.defineProperty(t.prototype,"value",{get:function(){return this.errorLogs.length},enumerable:!0,configurable:!0}),t}(f),e=function(n){function t(t,i){n.call(this,i,"term-"+t,t===1?"Today":"Last "+t+" days")}return __extends(t,n),Object.defineProperty(t.prototype,"count",{get:function(){return this.errorLogs.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"css",{get:function(){return this.count?"lightblue-bg clickable":"grey-bg"},enumerable:!0,configurable:!0}),t}(f),d=function(n){function t(t){n.call(this,"latest","Most recent");this.errorLogs=t.take(10)}return __extends(t,n),t}(t),g=function(n){function t(t,i,r){n.call(this,"frequent","Most frequent (by "+t+")");this.items=i.groupBy(r).orderByDescending(function(n){return n.length}).take(10).select(function(n){return new f(n,n.key)})}return __extends(t,n),t}(t),y=function(){function n(n,t,i,r){this.Area=n;this.Controller=t;this.Action=i;this.Method=r}return n.prototype.toString=function(){return"~"+n.prefix(this.Area,!this.Controller)+n.prefix(this.Controller)+n.prefix(this.Action)+(this.Method?" ["+this.Method+"]":"")},n.prefix=function(n,t){return t===void 0&&(t=!1),n?"/"+n:t?"/":""},n}(),c;(function(n){n[n.Large=0]="Large";n[n.Small=1]="Small";n[n.Wide=2]="Wide";n[n.ExtraWide=3]="ExtraWide"})(c||(c={}))})(Elfar||(Elfar={}));$(function(){return Elfar.App.init()});