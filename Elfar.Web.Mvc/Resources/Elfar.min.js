Date.prototype.addDays=function(n){return new Date(this.valueOf()).setDate(this.getDate()+n)};var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},Elfar;(function(n){"use strict";var a,v=function(){function n(){var t=this;this.select=function(n){var i=typeof n=="string"?t.tabs().first(function(t){return t.name===n}):n;i&&(t.tabs().forEach(function(n){return n.selected(!1)}),i.selected(!0))};this.add=function(n){if(n instanceof i){var r=t.tabs;r().contains(n)||r.push(n);t.select(n);return}t.dashboard.add(n)};this.remove=function(n){var i=t.tabs,r=i.indexOf(n);i.remove(n);n.selected()&&i()[--r].selected(!0)};this.show=function(i){if(i.Url){t.errorLog(i);return}$.get(n.path+"/Detail/"+i.ID,function(n){$.extend(i,n);t.errorLog(i)})};this[0]=ko.observableArray([]);this.add(this[1]=new o);this[2]=ko.observable()}return n.init=function(){ko.applyBindings(a=new n)},Object.defineProperty(n.prototype,"dashboard",{get:function(){return this[1]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"errorLog",{get:function(){return this[2]},enumerable:!0,configurable:!0}),Object.defineProperty(n,"path",{get:function(){return location.pathname},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"tabs",{get:function(){return this[0]},enumerable:!0,configurable:!0}),n}(),e,t,i,o,r,s,u;n.App=v;e=function(){function n(n){$.extend(this,n);this.Area&&(this.Area="/"+this.Area);this.DateTime=new Date(n.Date+" "+n.Time)}return n}();n.ErrorLog=e;t=function(){function n(n,t,i){this.name=n;this.title=t;this[0]=(i||n)+"-template"}return Object.defineProperty(n.prototype,"template",{get:function(){return this[0]},enumerable:!0,configurable:!0}),n}();n._Object=t;i=function(n){function t(t,i,r,u){u===void 0&&(u=!1);n.call(this,t,i,r);this[1]=ko.observable(u)}return __extends(t,n),Object.defineProperty(t.prototype,"closeable",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selected",{get:function(){return this[1]},enumerable:!0,configurable:!0}),t}(t);n.Tab=i;o=function(n){function t(){var t=this;n.call(this,"dashboard","Dashboard",null,!0);this[2]=ko.observableArray();$.get(v.path+"/Summaries",function(n){n=n.reverse().select(function(n){return new e(n)});t.add(t[3]=new s(n));t.add(new k(n))})}return __extends(t,n),t.prototype.add=function(n){if(n instanceof r){var t=this.sections;t().contains(n)||t.push(n);return}this.summary.add(n)},Object.defineProperty(t.prototype,"closeable",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sections",{get:function(){return this[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"summary",{get:function(){return this[3]},enumerable:!0,configurable:!0}),t}(i);n.Dashboard=o;r=function(n){function t(t,i,r){n.call(this,t,i,r)}return __extends(t,n),t}(t);n.Section=r;s=function(n){function t(t){n.call(this,"summary","Summary");this[1]=ko.observableArray();this.add(new h("Actions",t.groupBy(function(n){return new c(n.Area,n.Controller,n.Action)})),"donut",0);this.add(new h("Controllers",t.groupBy(function(n){return new c(n.Area,n.Controller)})),"donut",0);this.add(new h("Areas",t.groupBy(function(n){return new c(n.Area)})),"donut",0);var i=(new Date).setHours(0,0,0,0);this.add(new f(90,t=t.where(function(n){return i<=n.DateTime.addDays(90)})),"term");this.add(new f(30,t=t.where(function(n){return i<=n.DateTime.addDays(30)})),"term");this.add(new f(7,t=t.where(function(n){return i<=n.DateTime.addDays(7)})),"term");this.add(new f(1,t.where(function(n){return i<=n.DateTime.valueOf()})),"term")}return __extends(t,n),t.prototype.add=function(n,t,i){i===void 0&&(i=1);n instanceof u||(n=new u(n,t,i));this.tiles.push(n)},Object.defineProperty(t.prototype,"tiles",{get:function(){return this[1]},enumerable:!0,configurable:!0}),t}(r);n.Summary=s;u=function(n){function t(t,i,r){r===void 0&&(r=1);n.call(this,null,null,i);this.content=t;this[1]=r}return __extends(t,n),Object.defineProperty(t.prototype,"size",{get:function(){return l[this[1]].toLowerCase()},enumerable:!0,configurable:!0}),t}(t);n.Tile=u;var y=function(){function n(n,t){this.id=n;this.series=t}return Object.defineProperty(n,"colours",{get:function(){return n._colours},enumerable:!0,configurable:!0}),n._colours=["#68217A","#007ACC","#217167","#A83A95","#1BA1E2","#571C75","#009CCC","#9ACD32","#F2700F"].concat(Highcharts.getOptions().colors),n}(),h=function(n){function t(t,i){var u=this;n.call(this,t,[new w(t,i)]);var r=this.series[0],f=function(n){return a.add(r.points.first(function(t){return t.title===n.point.name}))},e={chart:{type:"pie",backgroundColor:"#F1F1F1",animation:!1},credits:{enabled:!1},tooltip:{enabled:!1},title:{text:r.count.toString(),y:27,verticalAlign:"middle",style:{fontSize:"33px"}},plotOptions:{pie:{shadow:!1,center:["50%","56%"],cursor:"pointer",events:{click:f}},series:{animation:!1}},series:[{name:this.id,data:r.data,size:"64%",innerSize:"53%",dataLabels:{color:"#FFF",format:"{y}",distance:-24,style:{fontWeight:"normal",textShadow:"none"}}}]};setTimeout(function(){return $("#"+u.id).highcharts(e)},1)}return __extends(t,n),t}(y),w=function(){function n(n,t){this.points=t.select(function(t,i){return new b(n,t,y.colours[i])})}return Object.defineProperty(n.prototype,"data",{get:function(){return this.points.select(function(n){return{name:n.title,y:n.value,color:n.colour}})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"count",{get:function(){return this.points.length},enumerable:!0,configurable:!0}),n}(),p=function(n){function t(t,i,r){n.call(this,t,i,"list");this.errorLogs=ko.observableArray();this.errorLogs(r)}return __extends(t,n),t}(i),b=function(n){function t(t,i,r){n.call(this,i.key[t.slice(0,-1)]||"[root]",i.key.toString(),i);this.colour=r}return __extends(t,n),Object.defineProperty(t.prototype,"value",{get:function(){return this.errorLogs().length},enumerable:!0,configurable:!0}),t}(p),f=function(n){function t(t,i){n.call(this,"term-"+t,t===1?"Today":"Last "+t+" days",i)}return __extends(t,n),Object.defineProperty(t.prototype,"count",{get:function(){return this.errorLogs().length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"css",{get:function(){return this.count?"lightblue-bg clickable":"grey-bg"},enumerable:!0,configurable:!0}),t}(p),k=function(n){function t(t){n.call(this,"latest","Most recent");this.errorLogs=t.take(10)}return __extends(t,n),t}(r),c=function(){function n(n,t,i,r){this.Area=n;this.Controller=t;this.Action=i;this.Method=r}return n.prototype.toString=function(){return"~"+n.prefix(this.Area,!this.Controller)+n.prefix(this.Controller)+n.prefix(this.Action)+(this.Method?" ["+this.Method+"]":"")},n.prefix=function(n,t){return t===void 0&&(t=!1),n?"/"+n:t?"/":""},n}(),l;(function(n){n[n.Large=0]="Large";n[n.Small=1]="Small";n[n.Wide=2]="Wide"})(l||(l={}))})(Elfar||(Elfar={}));$(function(){return Elfar.App.init()});