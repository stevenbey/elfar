Date.prototype.addDays=function(n){return new Date(this.valueOf()).setDate(this.getDate()+n)};var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},Elfar;(function(n){"use strict";var v,y=function(){function n(){var t=this;this.select=function(n){var i=typeof n=="string"?t.tabs().first(function(t){return t.name===n}):n,r;i&&(t.tabs().forEach(function(n){return n.selected(!1)}),r=i instanceof f,r&&i.blur(),i.selected(!0),r&&i.activate())};this.add=function(n){if(n instanceof i){var r=t.tabs;r().contains(n)||r.push(n);t.select(n);return}t.dashboard.add(n)};this.remove=function(n){if(n){var i=t.tabs,r=i.indexOf(n);n instanceof f&&n.clear();i.remove(n);n.selected()&&i()[--r].selected(!0)}};this.show=function(i){if(i.Url){t.errorLog(i);return}$.get(n.path+"/Detail/"+i.ID,function(n){$.extend(i,n);t.errorLog(i)})};this[0]=ko.observableArray([]);this.add(this[1]=new s);this[2]=ko.observable()}return n.init=function(){ko.applyBindings(v=new n)},Object.defineProperty(n.prototype,"dashboard",{get:function(){return this[1]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"errorLog",{get:function(){return this[2]},enumerable:!0,configurable:!0}),Object.defineProperty(n,"path",{get:function(){return location.pathname},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"tabs",{get:function(){return this[0]},enumerable:!0,configurable:!0}),n}(),o,t,i,s,r,h,u;n.App=y;o=function(){function n(n){$.extend(this,n);this.Area&&(this.Area="/"+this.Area);this.DateTime=new Date(n.Date+"T"+n.Time)}return n}();n.ErrorLog=o;t=function(){function n(n,t,i){this.name=n;this.title=t;this[0]=(i||n)+"-template"}return Object.defineProperty(n.prototype,"template",{get:function(){return this[0]},enumerable:!0,configurable:!0}),n}();n._Object=t;i=function(n){function t(t,i,r,u){u===void 0&&(u=!1);n.call(this,t,i,r);this[1]=ko.observable(u)}return __extends(t,n),Object.defineProperty(t.prototype,"closeable",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selected",{get:function(){return this[1]},enumerable:!0,configurable:!0}),t}(t);n.Tab=i;s=function(n){function t(){var t=this;n.call(this,"dashboard","Dashboard",null,!0);this[2]=ko.observableArray();$.get(y.path+"/Summaries",function(n){n=n.reverse().select(function(n){return new o(n)});t.add(t[3]=new h(n));t.add(new k(n))})}return __extends(t,n),t.prototype.add=function(n){if(n instanceof r){var t=this.sections;t().contains(n)||t.push(n);return}this.summary.add(n)},Object.defineProperty(t.prototype,"closeable",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sections",{get:function(){return this[2]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"summary",{get:function(){return this[3]},enumerable:!0,configurable:!0}),t}(i);n.Dashboard=s;r=function(n){function t(t,i,r){n.call(this,t,i,r)}return __extends(t,n),t}(t);n.Section=r;h=function(n){function t(t){n.call(this,"summary","Summary");this[1]=ko.observableArray();this.add(new c("Actions",t.groupBy(function(n){return new l(n.Area,n.Controller,n.Action)})),"donut",0);this.add(new c("Controllers",t.groupBy(function(n){return new l(n.Area,n.Controller)})),"donut",0);this.add(new c("Areas",t.groupBy(function(n){return new l(n.Area)})),"donut",0);var i=(new Date).setHours(0,0,0,0);this.add(new e(90,t=t.where(function(n){return i<=n.DateTime.addDays(90)})),"term");this.add(new e(30,t=t.where(function(n){return i<=n.DateTime.addDays(30)})),"term");this.add(new e(7,t=t.where(function(n){return i<=n.DateTime.addDays(7)})),"term");this.add(new e(1,t.where(function(n){return i<=n.DateTime.valueOf()})),"term")}return __extends(t,n),t.prototype.add=function(n,t,i){i===void 0&&(i=1);n instanceof u||(n=new u(n,t,i));this.tiles.push(n)},Object.defineProperty(t.prototype,"tiles",{get:function(){return this[1]},enumerable:!0,configurable:!0}),t}(r);n.Summary=h;u=function(n){function t(t,i,r){r===void 0&&(r=1);n.call(this,null,null,i);this.content=t;this[1]=r}return __extends(t,n),Object.defineProperty(t.prototype,"size",{get:function(){return a[this[1]].toLowerCase()},enumerable:!0,configurable:!0}),t}(t);n.Tile=u;var p=function(){function n(n,t){this.id=n;this.series=t}return Object.defineProperty(n,"colours",{get:function(){return n._colours},enumerable:!0,configurable:!0}),n._colours=["#68217A","#007ACC","#217167","#A83A95","#1BA1E2","#571C75","#009CCC","#9ACD32","#F2700F"].concat(Highcharts.getOptions().colors),n}(),c=function(n){function t(t,i){var u=this;n.call(this,t,[new w(t,i)]);var r=this.series[0],f=function(n){return v.add(r.points.first(function(t){return t.title===n.point.name}))},e={chart:{type:"pie",backgroundColor:"#F1F1F1",animation:!1},credits:{enabled:!1},tooltip:{enabled:!1},title:{text:r.count.toString(),y:27,verticalAlign:"middle",style:{fontSize:"33px"}},plotOptions:{pie:{shadow:!1,center:["50%","56%"],cursor:"pointer",events:{click:f}},series:{animation:!1}},series:[{name:this.id,data:r.data,size:"64%",innerSize:"53%",dataLabels:{color:"#FFF",format:"{y}",distance:-24,style:{fontWeight:"normal",textShadow:"none"}}}]};setTimeout(function(){return $("#"+u.id).highcharts(e)},1)}return __extends(t,n),t}(p),w=function(){function n(n,t){this.points=t.select(function(t,i){return new b(n,t,p.colours[i])})}return Object.defineProperty(n.prototype,"data",{get:function(){return this.points.select(function(n){return{name:n.title,y:n.value,color:n.colour}})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"count",{get:function(){return this.points.length},enumerable:!0,configurable:!0}),n}(),f=function(n){function t(i,r,u){var f=this;n.call(this,i,r,"list");this.select=function(n,t){f.clear();(f[4]=t.currentTarget).className="current selected"};this[2]=u;this[3]=ko.observable("");this.errorLogs=ko.computed(function(){var n=f.filter().toLowerCase(),i;return!n||n.length<3?f[2]:(i=t.props,f[2].where(function(t){for(var r=0;r<i.length;r++)if(t[i[r]].toLowerCase().indexOf(n)!==-1)return!0;return!1}))})}return __extends(t,n),t.prototype.activate=function(){var i=this,r,n=$("#"+this.id+" .filter"),t=$("input",n).focus(function(){t.removeAttr("placeholder");n.addClass("active")}).blur(function(){i.filter()||(r=setTimeout(function(){n.removeClass("active");t.attr("placeholder","Filter")},150))});$("span",n).click(function(){i.filter()?(i.filter(""),t.blur()):(n.hasClass("active")&&clearTimeout(r),t.focus())})},t.prototype.blur=function(){this[4]&&(this[4].className="selected")},t.prototype.clear=function(){this[4]&&(this[4].className=null)},Object.defineProperty(t.prototype,"filter",{get:function(){return this[3]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this.title.replace(/~?\//g,"_")},enumerable:!0,configurable:!0}),t.props=["Type","Action","Controller","Area","HttpMethod","Date"],t}(i),b=function(n){function t(t,i,r){n.call(this,i.key[t.slice(0,-1)]||"[root]",i.key.toString(),i);this.colour=r}return __extends(t,n),Object.defineProperty(t.prototype,"value",{get:function(){return this.errorLogs().length},enumerable:!0,configurable:!0}),t}(f),e=function(n){function t(t,i){n.call(this,"term-"+t,t===1?"Today":"Last "+t+" days",i)}return __extends(t,n),Object.defineProperty(t.prototype,"count",{get:function(){return this.errorLogs().length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"css",{get:function(){return this.count?"lightblue-bg clickable":"grey-bg"},enumerable:!0,configurable:!0}),t}(f),k=function(n){function t(t){n.call(this,"latest","Most recent");this.errorLogs=t.take(10)}return __extends(t,n),t}(r),l=function(){function n(n,t,i,r){this.Area=n;this.Controller=t;this.Action=i;this.Method=r}return n.prototype.toString=function(){return"~"+n.prefix(this.Area,!this.Controller)+n.prefix(this.Controller)+n.prefix(this.Action)+(this.Method?" ["+this.Method+"]":"")},n.prefix=function(n,t){return t===void 0&&(t=!1),n?"/"+n:t?"/":""},n}(),a;(function(n){n[n.Large=0]="Large";n[n.Small=1]="Small";n[n.Wide=2]="Wide"})(a||(a={}))})(Elfar||(Elfar={}));$(function(){return Elfar.App.init()});