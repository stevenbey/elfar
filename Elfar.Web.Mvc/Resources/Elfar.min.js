Date.prototype.addDays=function(n){return(new Date).setDate(this.getDate()+n)};var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},Elfar;(function(n){"use strict";function c(){}var o,r,u,s,f;n.app;n.registerPlugin=c;o=function(){function t(){var n=this;this.select=function(t){var i=typeof t=="string"?n.tabs().first(function(n){return n.name===t}):t;i&&(ko.utils.arrayForEach(n.tabs(),function(n){return n.selected(!1)}),i.selected(!0))};this.add=function(t){var i=n.tabs;i.indexOf(t)===-1&&i.push(t);n.select(t)};this.remove=function(t){var i=n.tabs,r=i.indexOf(t);i.remove(t);t.selected()&&i()[--r].selected(!0)};this[0]=ko.observableArray([]);this.add(this[1]=new s)}return t.init=function(){ko.applyBindings(n.app=new t)},Object.defineProperty(t.prototype,"dashboard",{get:function(){return this[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"path",{get:function(){return location.pathname},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tabs",{get:function(){return this[0]},enumerable:!0,configurable:!0}),t}();n.App=o;r=function(){function n(n,t,i){this.name=n;this.title=t;this._template=i;this._template=(i||n)+"-template"}return Object.defineProperty(n.prototype,"template",{get:function(){return this._template},enumerable:!0,configurable:!0}),n}();n._Object=r;u=function(n){function t(t,i,r){r===void 0&&(r=!1);n.call(this,t,i);this._selected=ko.observable(!1);this._selected(r)}return __extends(t,n),Object.defineProperty(t.prototype,"closeable",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selected",{get:function(){return this._selected},enumerable:!0,configurable:!0}),t}(r);n.Tab=u;s=function(n){function t(){var t=this;n.call(this,"dashboard","Dashboard",!0);this.sections=ko.observableArray();$.get(o.path+"/Summaries",function(n){t.summaries=n.select(function(n){return new l(n)}).orderByDescending(function(n){return n.Date});t.sections.push(new a(t.summaries));t.sections.push(new f(null,"Latest","latest"));t.sections.push(new f(null,"Most Common","common"))})}return __extends(t,n),t.prototype.add=function(n){this.sections.push(n)},Object.defineProperty(t.prototype,"closeable",{get:function(){return!1},enumerable:!0,configurable:!0}),t}(u);n.Dashboard=s;f=function(n){function t(t,i,r){n.call(this,t,i,r)}return __extends(t,n),t}(r);n.Section=f;var l=function(){function n(n){$.extend(this,n);this.dateTime=new Date(n.Date+" "+n.Time)}return n}(),a=function(n){function r(r){var f,o,u;n.call(this,"summary","Summary");this.items=ko.observableArray();f=function(n,t){var i=this;this.area=n;this.controller=t;this.toString=function(){return"~/"+(i.area?i.area+"/":"")+i.controller}};o=r.groupBy(function(n){return new f(n.Area,n.Controller)}).select(function(n,t){return new p(n,i.colours[t])});this.items.push(new t(new v("Controllers",o),"donut",0));this.items.push(new t(new i(1),"chart",0));this.items.push(new t(new i(2),"chart",2));this.items.push(new t(new i(3),"chart",1));this.items.push(new t(new i(4),"chart",1));u=(new Date).setHours(0,0,0,0);this.items.push(new t(new e(90,r.where(function(n){return u<=n.dateTime.addDays(90)})),"term-tile"));this.items.push(new t(new e(30,r.where(function(n){return u<=n.dateTime.addDays(30)})),"term-tile"));this.items.push(new t(new e(7,r.where(function(n){return u<=n.dateTime.addDays(7)})),"term-tile"));this.items.push(new t(new e(1,r.where(function(n){return u<=n.dateTime.valueOf()})),"term-tile"))}return __extends(r,n),r}(f),t=function(n){function t(t,i,r){r===void 0&&(r=1);n.call(this,null,null,i);this.content=t;this._size=r}return __extends(t,n),Object.defineProperty(t.prototype,"size",{get:function(){switch(this._size){case 0:return"large";case 2:return"wide";default:return"small"}},enumerable:!0,configurable:!0}),t}(r),e=function(n){function t(t,i){n.call(this,"term-tab",t===1?"Today":"Last "+t+" days");this.data=ko.observableArray();this.data(i)}return __extends(t,n),Object.defineProperty(t.prototype,"count",{get:function(){return this.data().length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"css",{get:function(){return this.count?"lightblue-bg clickable":"grey-bg"},enumerable:!0,configurable:!0}),t}(u),i=function(n){function t(t){n.call(this,t,t);this.id=t}return __extends(t,n),t.prototype.toString=function(){return this.id},Object.defineProperty(t,"colours",{get:function(){return["#68217A","#007ACC","#217167","#A83A95","#1BA1E2","#571C75","#009CCC","#9ACD32","#F2700F"].concat(Highcharts.getOptions().colors)},enumerable:!0,configurable:!0}),t}(u),v=function(n){function t(t,i){var u=this,r;n.call(this,t);this.series=i;r={chart:{type:"pie",backgroundColor:"#F1F1F1",animation:!1},credits:{enabled:!1},title:{text:""+i.sum(function(n){return n.value}),y:27,verticalAlign:"middle",style:{fontSize:"33px"}},plotOptions:{pie:{shadow:!1,center:["50%","56%"]},series:{animation:!1}},series:[{name:this.id,data:i.select(function(n){return n.data}),size:"64%",innerSize:"53%",dataLabels:{color:"#FFF",format:"{y}",distance:-24,style:{fontWeight:"normal",textShadow:"none"}}}]};setTimeout(function(){return $("#"+u.id).highcharts(r)},1)}return __extends(t,n),t}(i),y=function(){function n(n,t,i){this.key=n;this.value=t;this.colour=i}return Object.defineProperty(n.prototype,"data",{get:function(){return{name:this.key.toString(),y:this.value,color:this.colour}},enumerable:!0,configurable:!0}),n}(),p=function(n){function t(t,i){n.call(this,t.key,t.length,i)}return __extends(t,n),t}(y),h;(function(n){n[n.Large=0]="Large";n[n.Small=1]="Small";n[n.Wide=2]="Wide"})(h||(h={}))})(Elfar||(Elfar={}));$(function(){return Elfar.App.init()});