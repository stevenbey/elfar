var Convert=function(){function n(){}return n.toDictionary=function(n){return Object.keys(n).select(function(t){return{key:t,value:n[t]}})},n}(),__extends,Elfar,Bindings,unobtrusiveBindingsProvider;Date.prototype.addDays=function(n){return new Date(this.valueOf()).setDate(this.getDate()+n)};__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){"use strict";var o,a=function(){function n(t){var i=this;this._errorLog=ko.observable().extend({binding:"with"});this._tabs=ko.observableArray([]);this.select=function(n){n&&(i._currentTab&&i._currentTab.blur(),(i._currentTab=n).focus())};this.add=function(n){if(n instanceof r){var t=i.tabs;t&&!t().contains(n)&&t.push(n);i.select(n);return}i.dashboard.add(n)};this.remove=function(n){if(n&&n!==i.dashboard){var t=i.tabs,r=t.indexOf(n);n instanceof f&&(n.filter(""),n.clear());t.remove(n);n.selected()&&i.select(t()[--r])}};this.show=function(t){if(t.Url){i.errorLog(t);return}$.get(n.path+"Detail/"+t.ID,function(n){i.errorLog($.extend(t,n))})};this.add(this._dashboard=new h(t))}return n.init=function(){var t;$("#content").on("focus",".filter-wrapper input",function(){var n=$(this);n.removeAttr("placeholder");n.parent().addClass("active")}).on("blur",".filter-wrapper input",function(){var i=ko.dataFor(this),n;i.filter()||(n=$(this),t=setTimeout(function(){n.parent().removeClass("active");n.attr("placeholder","Filter")},150))}).on("click",".filter-wrapper span",function(){var n=ko.dataFor(this);n.filter()?(n.filter(""),$(".filter-wrapper input").blur()):($(this).parent().hasClass("active")&&clearTimeout(t),$(".filter-wrapper input").focus())}).on("click",".list .table-body > div",function(){var n=ko.contextFor(this).$parent;n.clear();n.row=$(this).addClass("current selected")});ko.bindingProvider.instance=new unobtrusiveBindingsProvider({"aspnet-html":"with: errorLog",chart:"attr: { id: id }","click(tab)":"click: $root.add","click(Type)":"click: $root.show","close(tab)":"visible: closeable, click: $root.remove","colour(legend)":"style: { backgroundColor: colour }","content(HTML)":"content: Html","content(section)":"template: template","content(tab)":"visible: selected, template: { name: template }","content(value)":"if: !(value instanceof Object)",cookies:"template: { name: 'i', data: Cookies }",dataTokens:"template: { name: 'i', data: DataTokens }","filter-wrapper":"css: { filtering: filter }",form:"template: { name: 'i', data: Form }",ignore:{bindings:"",override:!0},list:"attr: { id: id }",keys:"props: $data",queryString:"template: { name: 'i', data: QueryString }",routeData:"template: { name: 'i', data: RouteData }",routeDefaults:"template: { name: 'i', data: RouteDefaults }",routeConstraints:"template: { name: 'i', data: RouteConstraints }",section:"attr: { id: name }",serverVariables:"template: { name: 'i', data: ServerVariables }","show(!rows)":"visible: !rows().length","show(Cookies)":"visible: show(Cookies)","show(DataTokens)":"visible: show(DataTokens)","show(Form)":"visible: show(Form)","show(HTML)":"visible: Html","show(QueryString)":"visible: show(QueryString)","show(RouteConstraints)":"visible: show(RouteConstraints)",tab:"css:{selected:selected},click:$root.select,attr:{title:title}",term:"click: count ? $root.add : null, css: css",tile:"template: { name: template, data: content }, css: size","title(Action)":"attr: { title: Action }","title(Area)":"attr: { title: Area }","title(Controller)":"attr: { title: Controller }","title(Date)":"attr: { title: Date }","title(key)":"attr: { title: key }","title(legend)":"attr: { title: title }","title(Method)":"attr: { title: HttpMethod }","title(name)":"attr: { title: name }","title(term)":"attr: { title: title }","title(Time)":"attr: { title: Time }","title(Type)":"attr: { title: Type }"});o=new n(function(){return ko.applyBindings(o,$("main")[0])})},Object.defineProperty(n.prototype,"content",{get:function(){return this._tabs},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"dashboard",{get:function(){return this._dashboard},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"errorLog",{get:function(){return this._errorLog},enumerable:!0,configurable:!0}),Object.defineProperty(n,"path",{get:function(){return n._path},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"tabs",{get:function(){return this._tabs},enumerable:!0,configurable:!0}),n._path=location.pathname+"/",n}(),s,i,r,h,t,c,u;n.App=a;s=function(){function n(n){n&&($.extend(this,n),this.Area&&(this.Area="/"+this.Area),this.DateTime=new Date(n.Date+"T"+n.Time))}return n.prototype.show=function(n){return Object.keys(n).where(function(t){return!(n[t]instanceof Object)}).length},Object.defineProperty(n.prototype,"action",{get:function(){return this.Action},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"area",{get:function(){return this.Area},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"controller",{get:function(){return this.Controller},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"date",{get:function(){return this.Date},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"method",{get:function(){return this.HttpMethod},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"time",{get:function(){return this.Time},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"type",{get:function(){return this.Type},enumerable:!0,configurable:!0}),n}();n.ErrorLog=s;i=function(){function n(n,t,i){this.name=n;this.title=t;this._template=i||n;t||(this.title=n)}return Object.defineProperty(n.prototype,"template",{get:function(){return this._template},enumerable:!0,configurable:!0}),n}();n._Object=i;r=function(n){function t(t,i,r,u){u===void 0&&(u=!1);n.call(this,t,i,r);this._selected=ko.observable(u)}return __extends(t,n),t.prototype.blur=function(){this.selected(!1)},t.prototype.focus=function(){this.selected(!0)},Object.defineProperty(t.prototype,"closeable",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selected",{get:function(){return this._selected},enumerable:!0,configurable:!0}),t}(i);n.Tab=r;h=function(n){function i(t){var i=this;n.call(this,"dashboard","Dashboard","a",!0);this._sections=ko.observableArray();$.get(a.path+"Summaries",function(n){n=n.reverse().select(function(n){return new s(n)});i.add(i._summary=new c(n));n.length&&(i.add(new d(n)),i.add(new g("Type",n,function(n){return n.Type})));t()})}return __extends(i,n),i.prototype.add=function(n){if(n instanceof t){var i=this.sections;i().contains(n)||i.push(n);return}this.summary.add(n)},Object.defineProperty(i.prototype,"closeable",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"sections",{get:function(){return this._sections},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"summary",{get:function(){return this._summary},enumerable:!0,configurable:!0}),i}(r);n.Dashboard=h;t=function(n){function t(t,i,r){n.call(this,t,i,r);this.head=i}return __extends(t,n),t}(i);n.Section=t;c=function(n){function t(t){n.call(this,"summary","Summary","b");this._tiles=ko.observableArray();this.add(new w("Timeline",t.length?t.groupBy(function(n){return n.Date}):[t],90),"c",3);var r=(new Date).setHours(0,0,0,0),i=t;this.add(new e(90,i=i.where(function(n){return r<=n.DateTime.addDays(90)})),"d");this.add(new e(30,i=i.where(function(n){return r<=n.DateTime.addDays(30)})),"d");this.add(new e(7,i=i.where(function(n){return r<=n.DateTime.addDays(7)})),"d");this.add(new e(1,i.where(function(n){return r<=n.DateTime.valueOf()})),"d");t.length&&(this.add(new v("Actions",t.groupBy(function(n){return new y(n.Area,n.Controller,n.Action)})),"e",0),this.add(new v("Controllers",t.groupBy(function(n){return new y(n.Area,n.Controller)})),"e",0))}return __extends(t,n),t.prototype.add=function(n,t,i){i===void 0&&(i=1);n instanceof u||(n=new u(n,t,i));this.tiles.push(n)},Object.defineProperty(t.prototype,"tiles",{get:function(){return this._tiles},enumerable:!0,configurable:!0}),t}(t);n.Summary=c;u=function(n){function t(t,i,r){r===void 0&&(r=1);n.call(this,null,null,i);this.content=t;this._size=r}return __extends(t,n),Object.defineProperty(t.prototype,"size",{get:function(){return l[this._size].toLowerCase()},enumerable:!0,configurable:!0}),t}(i);n.Tile=u;var p=function(){function n(){}return Object.defineProperty(n,"colours",{get:function(){return n._colours},enumerable:!0,configurable:!0}),n._colours=["#68217A","#007ACC","#217167","#A83A95","#1BA1E2","#571C75","#009CCC","#9ACD32","#F2700F","#748189"].concat(Highcharts.getOptions().colors),n}(),v=function(){function n(n,t){this.id=n;var i=(this.series=[new b(n,t)])[0],r=function(n){return o.add(i.points.first(function(t){return t.title===n.point.name}))},u={chart:{type:"pie",backgroundColor:"#F1F1F1",animation:!1},credits:{enabled:!1},tooltip:{enabled:!1},title:{text:i.count.toString(),y:27,verticalAlign:"middle",style:{fontSize:"33px"}},plotOptions:{pie:{shadow:!1,center:["50%","56%"],cursor:"pointer",events:{click:r}},series:{animation:!1,states:{hover:{enabled:!1}}}},series:[{name:n,data:i.data,size:"64%",innerSize:"53%",dataLabels:{color:"#FFF",format:"{y}",distance:-24,style:{fontWeight:"normal",textShadow:"none"}}}]};setTimeout(function(){return $("#"+n).highcharts(u)},1)}return Object.defineProperty(n.prototype,"legend",{get:function(){return this.series[0].points},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"title",{get:function(){return this.id},enumerable:!0,configurable:!0}),n}(),w=function(){function n(n,t,i){this.id=n;this.groups=t;this.days=i;this.start=(new Date).addDays(-i);var r={chart:{backgroundColor:"#F1F1F1"},credits:{enabled:!1},xAxis:{type:"datetime",labels:{enabled:!1},lineWidth:0,tickLength:0},yAxis:{title:"",labels:{enabled:!1},min:0,max:t.max(function(n){return n.length}),gridLineWidth:0},legend:{enabled:!1},plotOptions:{area:{color:"#BBB",marker:{enabled:!1,states:{hover:{enabled:!1},select:{enabled:!1}}}},series:{animation:!1,states:{hover:{enabled:!1}}}},title:{text:""},tooltip:{enabled:!1},series:[{type:"area",name:"Error Logs",pointInterval:864e5,pointStart:this.start,data:this.data}]};setTimeout(function(){return $("#"+n).highcharts(r)},1)}return Object.defineProperty(n.prototype,"data",{get:function(){var r=[],n=new Date(this.start),t,i;if(this.groups.length)for(t=-this.days;t<0;t++)i=this.groups.first(function(t){return t.key===n.toISOString().split("T")[0]}),r.push(i?i.length:0),n.setDate(n.getDate()+1);return r},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"title",{get:function(){return this.id},enumerable:!0,configurable:!0}),n}(),b=function(){function n(n,t){this.points=t.select(function(t,i){return new k(n,t,p.colours[i])})}return Object.defineProperty(n.prototype,"data",{get:function(){return this.points.select(function(n){return{name:n.title,y:n.value,color:n.colour}})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"count",{get:function(){return this.points.length},enumerable:!0,configurable:!0}),n}(),f=function(n){function t(i,r,u){var f=this;n.call(this,r,u,"h");this.errorLogs=i;this._filter=ko.observable("").extend({binding:"textInput"});this.rows=ko.computed(function(){var n=f.filter().toLowerCase(),i,r;return!n||n.length<2?f.errorLogs:(i=t.props,r=new RegExp(n,"g"),f.errorLogs.where(function(n){for(var t=0;t<i.length;t++)if(r.test(n[i[t]].toLowerCase()))return!0;return!1}))})}return __extends(t,n),t.prototype.blur=function(){n.prototype.blur.call(this);this.row&&this.row.removeClass("current")},t.prototype.clear=function(){this.row&&this.row.removeClass("selected")},Object.defineProperty(t.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this.title.replace(/~?\/|\s/g,"")||"root"},enumerable:!0,configurable:!0}),t.props=["Type","Action","Controller","Area","HttpMethod","Date"],t}(r),k=function(n){function t(t,i,r){n.call(this,i,i.key[t.slice(0,-1)]||"[root]",i.key.toString());this.colour=r}return __extends(t,n),Object.defineProperty(t.prototype,"value",{get:function(){return this.errorLogs.length},enumerable:!0,configurable:!0}),t}(f),e=function(n){function t(t,i){n.call(this,i,"term-"+t,t===1?"Today":"Last "+t+" days")}return __extends(t,n),Object.defineProperty(t.prototype,"body",{get:function(){return this.count},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"count",{get:function(){return this.errorLogs.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"css",{get:function(){return this.count?"lightblue-bg clickable":"grey-bg"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"head",{get:function(){return this.title},enumerable:!0,configurable:!0}),t}(f),d=function(n){function t(t){n.call(this,"latest","Most recent","f");this.errorLogs=t.take(10)}return __extends(t,n),t}(t),g=function(n){function t(t,i,r){n.call(this,"frequent","Most frequent (by "+t+")","g");this.items=i.groupBy(r).orderByDescending(function(n){return n.length}).take(10).select(function(n){return new f(n,n.key)})}return __extends(t,n),t}(t),y=function(){function n(n,t,i,r){this.Area=n||"";this.Controller=t||"";this.Action=i||"";this.Method=r||""}return n.prototype.toString=function(){return"~"+n.prefix(this.Area,!this.Controller)+n.prefix(this.Controller)+n.prefix(this.Action)+(this.Method?" ["+this.Method+"]":"")},n.prefix=function(n,t){return t===void 0&&(t=!1),n?"/"+n:t?"/":""},n}(),l;(function(n){n[n.Large=0]="Large";n[n.Small=1]="Small";n[n.Wide=2]="Wide";n[n.ExtraWide=3]="ExtraWide"})(l||(l={}))}(Elfar||(Elfar={}));$(Elfar.App.init);ko.bindingHandlers.props={init:function(n,t,i,r,u){var f=ko.utils.unwrapObservable(t()),e=Convert.toDictionary(f).orderBy(function(n){return n.key});return ko.applyBindingsToNode(n,{foreach:e},u),{controlsDescendantBindings:!0}}};ko.bindingHandlers.content={init:function(n,t){var i=n.contentWindow.document;i.close();i.write(ko.unwrap(t()))}};ko.extenders.binding=function(n,t){return n.binding=t,n};ko.extenders.bindings=function(n,t){return n.bindings=t,n};Bindings=function(){function n(){}return n.for=function(t,i,r){var o,u,h,e,c,s,v,l;if(t.nodeType===1&&(o=t.id||t.name||t.className,o)){var y=t.nodeName.toLowerCase(),a=n.path(t),f=n.cache[a];if(f===undefined){if(u=n.find(o,r),h=!1,u.value!==undefined&&(e=u.value,typeof e=="string"?f=e:("bindings"in e&&(h=e.override,e=e.bindings),f=n.from(e))),!h){for(u=n.find(o,i.$data),c=i.$parents,s=0,v=c.length;s<v&&u.value===undefined;s++)if(u=n.find(o,c[s]),u.value!==undefined){u.key="$parents["+s+"]."+u.key;break}u.value!==undefined&&(l=n.get(u,y),f?f+=","+l:f=l)}n.cache[a]=f}return f}return undefined},n.find=function(n,t){for(var r,u,s,f={key:null,value:undefined},o=n.split(" "),i=undefined,e=0,h=o.length;e<h&&i===undefined;e++)if(n=o[e],i=t[n],i===undefined&&/-/.test(n)){for(r=n.split("-"),u=0,s=r.length;u<s;u++)if(n=r[u],i=t[n],ko.isObservable(i))r[u]+="()",t=ko.unwrap(i);else if(typeof i=="object")t=i;else if(i===undefined)break;n=r.join(".")}return i!==undefined&&(f.key=n,f.value=i),f},n.from=function(n){return typeof n=="string"?n:(n=ko.toJSON(n),n.substr(1,n.length-2))},n.get=function(t,i){var o=t.key,f=t.value,u="text",e,r;switch(i){case"input":case"select":u="value"}if(ko.isObservable(f)){if(e=f.peek(),e&&"push"in e?u=i==="select"?"selectedOptions":"foreach":typeof e=="object"&&(u="with"),r=f.binding,r&&(i==="input"||r!=="textInput")&&(u=r),r=f.bindings,r){if(typeof r!="string"){if(r.override)return r.value;r=n.from(r.value)}o+=","+r}}else f instanceof Function?u="click":f instanceof Array?u=i==="select"?"selectedOptions":"foreach":typeof f=="object"&&(u="with");return u+":"+o},n.path=function(n){return $(n).parents().addBack().toArray().reduce(function(n,t){var i=t.nodeName.toLowerCase();return i!=="html"&&i!=="body"&&(n+="/"+i,t.id!==""&&(n+="#"+t.id),t.name!==""&&(n+=":"+t.name),t.className!==""&&(n+="."+t.className)),n},"")},n.cache={},n}();unobtrusiveBindingsProvider=function(){function n(n){n===void 0&&(n={});this.inner=ko.bindingProvider.instance;this.inner.getBindingsString=function(t,i){return Bindings.for(t,i,n)}}return n.prototype.nodeHasBindings=function(n){return n.nodeType===1&&(n.id||n.name||n.className)},n.prototype.getBindingAccessors=function(n,t){return this.inner.getBindingAccessors(n,t)},n.prototype.getBindings=function(n,t){return this.inner.getBindings(n,t)},n}();