Date.prototype.addDays=function(n){return(new Date).setDate(this.getDate()+n)};var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},Elfar;(function(n){"use strict";var o,r,f,s,u;n.app;o=function(){function t(){var n=this;this.tabs=ko.observableArray([]);this.selectTab=function(t){var i;i=typeof t=="string"?n.tabs().first(function(n){return n.name===t}):t;ko.utils.arrayForEach(n.tabs(),function(n){return n.selected(!1)});i||(i=n.tabs()[0]);i.selected(!0)};this.addTab=function(t){var i=n.tabs;i.indexOf(t)===-1&&i.push(t);n.selectTab(t)};this.removeTab=function(t){var i=n.tabs,r=i.indexOf(t);i.remove(t);t.selected()&&i()[--r].selected(!0)};this.addTab(this._dashboard=new s)}return t.init=function(){console.log("Elfar.App initialising...");ko.applyBindings(n.app=new t);console.log("Elfar.App initialised")},Object.defineProperty(t.prototype,"dashboard",{get:function(){return this._dashboard},enumerable:!0,configurable:!0}),Object.defineProperty(t,"path",{get:function(){return location.pathname},enumerable:!0,configurable:!0}),t}();n.App=o;r=function(){function n(n,t,i){this.name=n;this.title=t;this._template=i;this._template=(i||n)+"-template"}return Object.defineProperty(n.prototype,"template",{get:function(){return this._template},enumerable:!0,configurable:!0}),n}();n._Object=r;f=function(n){function t(t,i){n.call(this,t,i);this.selected=ko.observable(!1)}return __extends(t,n),Object.defineProperty(t.prototype,"closeable",{get:function(){return!0},enumerable:!0,configurable:!0}),t}(r);n.Tab=f;s=function(n){function t(){var t=this;n.call(this,"dashboard","Dashboard");this.sections=ko.observableArray();$.get(o.path+"/Summaries",function(n){t.summaries=n.select(function(n){return new l(n)}).orderByDescending(function(n){return n.Date});t.sections.push(new a(t.summaries));t.sections.push(new u(null,"Latest","latest"));t.sections.push(new u(null,"Most Common","common"))});this.selected(!0)}return __extends(t,n),t.prototype.add=function(n){this.sections.push(n)},Object.defineProperty(t.prototype,"closeable",{get:function(){return!1},enumerable:!0,configurable:!0}),t}(f);n.Dashboard=s;u=function(n){function t(t,i,r){n.call(this,t,i,r)}return __extends(t,n),t}(r);n.Section=u;var l=function(){function n(n){$.extend(this,n);this.dateTime=new Date(n.Date+" "+n.Time)}return n}(),a=function(n){function r(r){var f,u;n.call(this,"summary","_Summary");this.items=ko.observableArray();f=r.groupBy(function(n){return"~/"+(n.Area?n.Area+"/":"")}).select(function(n,t){return new y(n,i.colours[t])});this.items.push(new t(new v("Controllers",f),"chart",0));this.items.push(new t(new i(1),"chart",0));this.items.push(new t(new i(2),"chart",2));this.items.push(new t(new i(3),"chart",1));this.items.push(new t(new i(4),"chart",1));u=(new Date).setHours(0,0,0,0);this.items.push(new t(new e(90,r.where(function(n){return u<=n.dateTime.addDays(90)})),"term-tile"));this.items.push(new t(new e(30,r.where(function(n){return u<=n.dateTime.addDays(30)})),"term-tile"));this.items.push(new t(new e(7,r.where(function(n){return u<=n.dateTime.addDays(7)})),"term-tile"));this.items.push(new t(new e(1,r.where(function(n){return u<=n.dateTime.valueOf()})),"term-tile"))}return __extends(r,n),r}(u),t=function(n){function t(t,i,r){r===void 0&&(r=1);n.call(this,null,null,i);this.content=t;this._size=r}return __extends(t,n),Object.defineProperty(t.prototype,"size",{get:function(){switch(this._size){case 0:return"large";case 2:return"wide";default:return"small"}},enumerable:!0,configurable:!0}),t}(r),e=function(n){function t(t,i){n.call(this,"term-tab",t===1?"Today":"Last "+t+" days");this.data=ko.observableArray();this.data(i)}return __extends(t,n),Object.defineProperty(t.prototype,"count",{get:function(){return this.data().length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"css",{get:function(){return this.count?"lightblue-bg clickable":"grey-bg"},enumerable:!0,configurable:!0}),t}(f),i=function(){function n(n){this.id=n}return Object.defineProperty(n,"colours",{get:function(){return["#68217A","#007ACC","#217167","#A83A95","#1BA1E2","#571C75","#009CCC","#9ACD32","#F2700F"].concat(Highcharts.getOptions().colors)},enumerable:!0,configurable:!0}),n}(),v=function(n){function t(t,i){var u=this,r;n.call(this,t);r={chart:{type:"pie",backgroundColor:"#F1F1F1",animation:!1},credits:{enabled:!1},title:{text:this.id,floating:!0,align:"left",style:{fontSize:"16px"}},tooltip:{formatter:function(){return this.point.name+" (<b>"+this.point.y+"<\/b>)"}},plotOptions:{pie:{shadow:!1,center:["50%","55%"],dataLabels:{enabled:!1},showInLegend:!0},series:{animation:!1}},series:[{name:"Areas",data:i.select(function(n){return n.data}),size:"59%",showInLegend:!1},{name:"Controllers",data:i.selectMany(function(n){return n.controllers}).select(function(n){return n.data}),size:"84%",innerSize:"60%"}]};setTimeout(function(){return $("#"+u.id).highcharts(r)},1)}return __extends(t,n),t}(i),h=function(){function n(n,t){this.colour=t;this.name=n.key;this.value=n.length}return Object.defineProperty(n.prototype,"data",{get:function(){return{name:this.name,y:this.value,color:this.colour}},enumerable:!0,configurable:!0}),n}(),y=function(n){function t(t,i){n.call(this,t,i);var r=Highcharts.Color(i);this.controllers=t.groupBy(function(n){return t.key+n.Controller}).select(function(n,t){var i=r.brighten(.1-t/n.length/50);return new p(n,i.get(null))})}return __extends(t,n),t}(h),p=function(n){function t(t,i){n.call(this,t,i);var r=Highcharts.Color(i);this.actions=t.groupBy(function(n){return t.key+"/"+n.Action}).select(function(n,t){var i=r.brighten(.1-t/n.length/50);return new h(n,i.get(null))})}return __extends(t,n),t}(h),c;(function(n){n[n.Large=0]="Large";n[n.Small=1]="Small";n[n.Wide=2]="Wide"})(c||(c={}))})(Elfar||(Elfar={}));$(function(){return Elfar.App.init()});