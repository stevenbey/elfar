var dataTable,chart,headers={2:'Host',3:'Application',4:'Code',5:'Type',7:'Date'},data=[];function showChart(){if(chart) chart.destroy();var series;switch(this.selectedIndex){case 0:series=[{name:'Errors',data:data.timeline}];break;case 1:series=getSeries(data.hosts);break;case 2:series=getSeries(data.applications);break;case 3:series=getSeries(data.codes);break;case 4:series=getSeries(data.types);break}chart=new Highcharts.Chart({chart:{renderTo:'graph',type:'areaspline'},title:{text:''},xAxis:{type:'datetime'},yAxis:{title:{text:'Errors'},min:0},tooltip:{shared:true},series:series})}Array.prototype.groupBy=function(selector){var obj={};var converter;for(var i=0;i<this.length;i++){var value=selector(this[i]);if(!converter) converter=new Converter(value);if(!obj[value]) obj[value]=[];obj[value].push(this[i])}var grouped=[];for(key in obj){obj[key].key=converter.convert(key);grouped.push(obj[key])}return grouped};Array.prototype.orderBy=function(selector){if(!selector) throw "selector cannot be null";return this.sort(function(a,b){return Number(selector(a))-Number(selector(b))})};Array.prototype.select=function(selector){var array=[];for(var i=0;i<this.length;i++)array.push(selector(this[i]));return array};function getChartData(){dataTable.$("tr").each(processRow);data=new ChartData(data)}function processRow(){var obj={};$('td',this).each(function(i){var header=headers[i];if(header){var value=this.innerHTML;if(i==3&&!value) value='<em>null</em>';if(i==4) value=value?Number(value):0;if(i==7){var parts=value.match(/\d+/g);value=new Date(parts[2],parts[1]-1,parts[0])}obj[header]=value}});data.push(obj)}function Converter(obj){if(obj instanceof Array) this.convert=function(v){return v.split(',')};else if(obj instanceof Boolean) this.convert=function(v){return v==="true"};else if(obj instanceof Date) this.convert=function(v){return new Date(v)};else if (obj instanceof Number) this.convert=function(v){return new Number(v)};else this.convert=function(v){return v}}function ChartData(data){this.timeline=data.orderBy(byDate).groupBy(byDate).select(selectDate);this.hosts=data.groupBy(function(o){return o.Host}).select(selectDates);this.applications=data.groupBy(function(o){return o.Application}).select(selectDates);this.codes=data.groupBy(function(o){return o.Code}).select(selectDates);this.types=data.groupBy(function(o){return o.Type}).select(selectDates)}function getSeries(array){var series=[];$.each(array,function(i,obj){series.push({name:obj.key,data:obj})});return series}function byDate(o){return o.Date}function selectDate(g){return [Number(g.key),g.length]}function selectDates(g){var array=g.groupBy(byDate).orderBy(byDate).select(selectDate);array.key=g.key;return array}$(function(){dataTable=$("table").bind('draw',bindEvents).dataTable({"bJQueryUI":true,"sPaginationType":"full_numbers","aoColumnDefs":[{"bSortable":false,"aTargets":[0,7]}],"aLengthMenu":[[10,25,50,100,250,500,-1],[10,25,50,100,250,500,"All"]]});$("#select-all").change(function(){checkboxes().attr('checked',this.checked);bindEvents()});$("#delete").click(function(){return confirm("Are you sure you want to delete the selected error log(s)?")});$("#charts").click(function(){dialog_open();$("#dialog select").change()});getChartData();$("#dialog").dialog("option","height",462);$("#dialog").dialog("option","close",function(){dialog_close();chart=null;$("#dialog select").val("Date")});$("#dialog select").change(showChart)})